---
layout: post
title: 信道估计
categories: 通信
description: 有关信道估计的基础知识
keywords: 通信
mermaid: false
sequence: false
flow: false
mathjax: true
mathjax: true
mindmap: false
mindmap2: false
---

## 无线信道的影响

在无线传播环境中，信号在发射端与接收端之间会经历复杂的传播过程。影响信号的两大主要物理现象是：

- 多径（延迟扩展）：

信号经由不同路径（直射、反射、散射、绕射等）到达接收端，每条路径的传播时延、幅度和相位均不同。

- 相对运动（多普勒扩展）：

当收发双方或周围散射体存在相对运动时，信号频率会发生偏移，不同路径的频移可能不同，导致信道随时间变化。

这两种物理现象导致了无线信道在频率和时间两个维度的变化：

- 频率选择性衰落：不同频率（子载波）衰落程度和相位旋转不同。

- 时间选择性衰落：信道随时间变化，信道状态信息（CSI）会变化。

### 多径效应

1. **物理来源**  
   多条传播路径的延迟差异会使接收信号出现时间拖尾。若符号持续时间不足以容纳最大路径延迟，前后符号会相互干扰，即**符号间干扰（ISI）**。

2. **频域表现**  
   多径会导致频率响应出现起伏。起伏的平滑程度由**相干带宽**（$$B_c$$)）决定。  

   - **相干带宽**反映信道在频域内保持高度相关的频率范围，近似公式：  

    $$
    B_c \approx \frac{1}{5\tau_{\mathrm{rms}}} \quad (\text{相关系数} \approx 0.5)
    $$

    $$
    B_c \approx \frac{1}{50\tau_{\mathrm{rms}}} \quad (\text{相关系数} \approx 0.9)
    $$  
    其中 $$\tau_{\mathrm{rms}}$$ 为均方根延迟扩展（RMS Delay Spread）。

   - **判据**：  
     - 若 $$B_{\mathrm{sig}} \ll B_c$$ → **平衰落**（频率平坦）  
     - 若 $$B_{\mathrm{sig}} \gtrsim B_c$$ → **频率选择性衰落**

3. **应对措施**  
   - 单载波系统：符号时长增加、使用均衡器补偿 ISI。  
   - 多载波系统（OFDM）：加入循环前缀（CP）≥最大路径延迟，逐子载波信道估计与补偿。

### 多普勒效应

1. **物理来源**  
   信号在传播过程中，若收发端或反射体存在相对速度 $$v$$，会产生**多普勒频移**：
   $$
   f_{D,\max} = \frac{v f_c}{c}
   $$
   其中 $$f_c$$ 为载波频率，$$c$$ 为光速。不同路径的运动方向不同，导致频移分布形成**多普勒谱**。

2. **时域表现**  
   信道在时间上快速变化，相关性随时间衰减。用**相干时间**（$$T_c$$）衡量信道保持稳定的时间范围：  
   $$
   T_c \approx \frac{0.423}{f_{D,\max}}
   $$
   - **判据**：  
     - 若 $$\Delta t \ll T_c$$ → 估计有效  
     - 若 $$\Delta t \gtrsim T_c$$ → 出现**时间选择性衰落**（估计失配）  
   - 在 OFDM 中，若 $$\Delta f \lesssim f_{D,\max}$$，还会出现**ICI（载波间干扰）**。

3. **应对措施**  
   - 增加导频密度，确保 $$\Delta t < T_c$$  
   - 引入信道跟踪/更新算法  
   - 在高速移动场景中，适当增大子载波间隔减少 ICI。

### MATLAB 实例

- 设定系统采样率 fs=30.72 MHz，子载波间隔 df=60 kHz（这里没直接用到 df，只是给上下文）。

- 给出 3 条多径：延迟（秒）与增益（dB）。

```matlab
% -------- 系统参数 --------
fs   = 30.72e6;       % 采样率
df   = 60e3;          % 子载波间隔
% -------- 多径信道 --------
path_delays = 0.153e-6.*[0, 1.5133, 2.5440]; % 秒
path_gains_dB = [-0.03, -15.8, -18.1];       % dB
path_gains = 10.^(path_gains_dB/20);
```

- 把连续时间的路径延迟量化到采样点：n_del = round(path_delays*fs)。

- 构造离散冲激响应 h：在对应的抽头位置写入线性幅度 × 随机相位，其余为 0。

```matlab
n_del = round(path_delays*fs);
for i = 1:numel(path_gains)
    h(n_del(i)+1) = path_gains(i) * exp(1j*2*pi*rand); % 随机相位
end
```

易求得多径出现在索引1、8、13的位置。

因此，离散冲激响应可以写成：

$$
h[n]=a_1 e^{j \theta_1} \delta[n-\mathbf{0}]+a_2 e^{j \theta_2} \delta[n-\mathbf{7}]+a_3 e^{j \theta_3} \delta[n-\mathbf{1 2}]
$$

其中a是参数中的信道增益，角度值为随机相位。

绘制时域冲激响应如下：

![冲激响应](/images/2025-08-12-信道估计/冲激响应.jpg)

进一步地，把离散冲激响应 h[n] 转换到频域，并且生成一个高分辨率、中心对齐的频率响应曲线：

```matlab
Nfft_plot = 2^16;
Hf = fftshift(fft(h, Nfft_plot));
f = linspace(-fs/2, fs/2, Nfft_plot);
```

计算 RMS 延迟扩展：

$$
\tau_{\mathrm{rms}}=\sqrt{\frac{\sum\left(\tau_i-\bar{\tau}\right)^2 \cdot\left|h_i\right|^2}{\sum\left|h_i\right|^2}}
Bc05 = 1/(5*tau_rms);  % ~相关系数0.5
Bc09 = 1/(50*tau_rms); % ~相关系数0.9
$$

并通过经验公式给出相干带宽：

$$B_c(0.5) \approx \frac{1}{5 \tau_{\mathrm{rms}}}$$：使相关系数 ≈ 0.5 的带宽

$$B_c(0.9) \approx \frac{1}{50 \tau_{\mathrm{rms}}}$$：使相关系数 ≈ 0.9 的带宽

最后：

- 画出信道频率响应曲线

- 标注相干带宽范围（B_c(0.5)、B_c(0.9)）

- 用颜色区分不同带宽的平坦衰落区域

- 标出子载波带宽和系统总带宽的参考线

![频率响应](/images/2025-08-12-信道估计/频率响应.jpg)

可以看到，信道是**频率选择性衰落**，**一个OFDM符号内的子载波会经历不同增益**，但在单个子载波带宽内，或在相干带宽范围内，信道可以近似视为**平坦衰落**。

---

下面的仿真采用 Jakes 正弦和法生成了归一化的复高斯平坦衰落信道系数序列，并用以观察多普勒效应引起的信道时域变化特性。

![多普勒场景时间响应](/images/2025-08-12-信道估计/多普勒场景时间响应.jpg)

- 振幅随时间的波动反映了无线信道在多普勒频移下的衰落现象。
- 低多普勒时，信道变化缓慢；高多普勒时，波动速度会显著加快。
- 相干时间内，信道状态（复系数）具有一定的相关性。

### 信道小节

- **相干带宽**：信道在多大频率跨度内频率相关性强，主要由多径时延扩展决定。与均方根时延扩展的常用近似关系有多种定义阈值。

可以直观理解成，均方时延扩展越大（即多径拖得越长），频域起伏越大，相干带宽越小；反之亦然。

- **相干时间**是信道的**时间相关性尺度**：在该时间内，信道的幅度和相位衰落相关性高，多普勒效应还没让信道发生显著变化。

超过该时间后，信道就开始显著变化，自相关系数下降，意味着之前的信道估计不再准确。

**对系统设计的意义：**

信道估计的有效性：

- 频率方向，如果导频在频域的间隔太宽，超过了信道的相干带宽，那么在两个导频之间的频率点上，信道增益和相位可能会出现较大差异，会导致估计误差。因此，**频域上的导频间隔应该小于相干带宽的一定比例**，以保证频域插值的有效性。

- 时间方向，如果导频符号之间的时间间隔太大，超过了信道的相干时间，信道在两个导频之间就会发生明显变化，这会让基于插值的信道估计失准。因此，导频时间间隔应设计得足够小，**通常只取相干时间的一部分**，这样插值得到的信道信息才比较可靠。

在OFDM系统参数设计上：

- 子载波间隔应远小于相干带宽；

- 循环前缀长度大于最大时延扩展；

- 导频栅格在时间和频率方向都不能超出相干范围。

## 导频类型

在无线通信系统中，信道估计的精度直接影响均衡、解调和译码的性能。为获取准确的信道信息，系统会在数据符号中插入已知的导频符号（Pilot Symbols）。根据导频在时频资源上的分布方式不同，常见的导频类型包括以下几种：

### 块型导频（Block-Type Pilots）

定义：在一个或多个完整符号的所有子载波位置上都发送导频符号，其余时间用于数据传输。

**特点：**

- 适合信道变化缓慢（相干时间长）的场景。

- 一次块型导频可用于估计整个频带的信道响应。

- 估计更新周期较长，适合低速移动或静止环境。

**优点**：实现简单、估计性能稳定。

**缺点**：当信道变化快时，导频更新不及时会导致估计过期。

![块状导频](/images/2025-08-12-信道估计/块状导频.png)

**块状导频示例：**

![块状导频实例](/images/2025-08-12-信道估计/块状导频实例.png)

WIFI系统导频结构说明：

- Preamble（前导）

  - 位于帧的起始位置，全频带、整符号的导频信号。

  - 用于初始信道估计（Channel Estimation），在接收端刚开始解帧时进行。

  - 估计结果提供给均衡器，用来对后续数据符号做初始均衡。

- Data（数据符号）

  - 用于承载业务数据，通过均衡器和解调器恢复原始信息。

- Midamble（中间导频）

  - 位于数据块之间的整符号导频，提供时间上的“重校准点”。

  - 用于信道跟踪与更新（Channel Tracking & Update），跟踪信道随时间的变化。

  - 可以在移动场景下保持信道估计的准确性。

### 梳状导频（Comb-Type Pilots）

定义：在每个符号的部分子载波位置插入导频，其余子载波用于数据传输。

**特点：**

- 适合信道随时间变化较快（相干时间短）的场景。

- 可在频域上通过插值估计所有子载波的信道响应。

- 估计可在每个符号周期更新。

- 优点：能快速跟踪信道变化，适用于高速移动环境。

- 缺点：频域插值精度依赖导频间隔与相干带宽的关系，间隔过大会导致估计误差增大。

![梳状导频](/images/2025-08-12-信道估计/梳状导频.png)

**示例：**

![梳状导频实例](/images/2025-08-12-信道估计/梳状导频实例.png)

除了前导和中间导频，梳妆导频还存在于OFDM符号的**部分子载波位置**。

当多普勒频移较大、相干时间较短时，仅靠前导（Preamble）或中间导频（Midamble）可能跟不上信道变化，**梳状导频可以在两个块状导频之间起到“细粒度跟踪”的作用**。

**其起到与状/中间导频的互补作用**：

- 块状导频（Preamble / Midamble）：一次性估计整个频带的信道，适合初始估计和周期性重校准。

- 梳状导频（Data符号内）：细粒度地在频域和时间域跟踪信道变化，保持均衡器和解调器在导频间隔内的精度。

### 时频二维导频/格状导频（2D Pilots / Scattered Pilots）

定义：在时间和频率两个维度上按照一定的间隔插入导频符号，形成规则的二维栅格。

特点：

- 同时适应时间选择性和频率选择性衰落信道。

- 通过二维插值方法同时利用时间和频率方向的相关性。

**优点**：适用范围广，适合多径与多普勒效应同时显著的信道。

**缺点**：设计复杂，插值开销较大。

**格状导频示例**：

下图给出LTE常规 CP 下，小区专用参考信号映射图，扩展 CP 下的参考信号同常规的基本相似。

![LTE导频](/images/2025-08-12-信道估计/LTE导频.png)

- 频域分布
  
  - 在插有参考信号的 OFDM 符号中，LTE 系统每 6 个子载波插入 1 个参考信号。

  - 在相邻的两个含有参考信号的 OFDM 符号之间，参考信号的子载波位置相互错开，从频域上看，相当于每 3 个子载波就有 1 个参考信号。

即参考信号在频域上的间隔为 45 kHz。这种布置保证了在频域方向上，接收端能够分辨出信道在不同频率点上的变化，从而实现有效的频域信道估计。

- 时域分布

  - 在一个时隙内，参考信号插在**第 1 个 OFDM 符号**和**倒数第 3 个 OFDM 符号**上。

在这两个符号中，参考信号的频域位置呈交错分布，这样可以提高时频域上的采样密度，有助于同时跟踪时间选择性和频率选择性的信道变化。

![LTE导频多天线](/images/2025-08-12-信道估计/LTE导频多天线.png)

LTE 系统下行参考信号也支持多发射天线传输:

- 支持多发射天线（MIMO）场景。
- 不同天线端口对应不同的参考信号序列。

参考信号交错设计:不同天线端口的参考信号在时频资源上交错分布。

**具体映射规律如下：**

- 2 天线端口（Port 0, Port 1）：
  
  - 参考信号在两个 OFDM 符号（时隙的第 1 个和倒数第 3 个符号）中均有分布。
  - 相比单天线端口密度翻倍

- 4 天线端口（Port 0, 1, 2, 3）：

  - Port 0、Port 1：保持与 2 天线时相同的分布规律。
  - Port 2、Port 3：只在每个时隙序号1的 OFDM 符号中插入参考信号。

**设计原因：**

- 4 发射天线的 MIMO 场景多应用于低速移动环境。
- 低速场景下每时隙仅一列参考信号即可满足信道估计需求。

**接收端信道估计：**

- 由于参考信号的交错性，UE 可以分别针对不同天线端口做独立信道估计。
- 降低了多天线信道估计的实现复杂度。

可以通过 MATLAB 查看 LTE 参考信号在资源栅格中的位置，关键代码如下：

```matlab
sz = lteDLResourceGridSize(enb);   % [K L P]，K=12*NDLRB
K = sz(1); L = sz(2); P = sz(3);
```

`lteDLResourceGridSize` 按 `enb` 返回下行资源栅格大小:

- `K` = 子载波数 = 12 × `NDLRB`（例：50 RB → 600 条子载波）
- `L` = OFDM 符号数（Normal=14，Extended=12）
- `P` = 天线端口数

三者定义了一个 K × L × P 的三维网格（频 × 时 × 端口），CRS 位置就是这个 3D 网格中的若干点。

```matlab
rsInd_1 = lteCellRSIndices(enb,'1based');
```

- `lteCellRSIndices` 根据 `enb` 配置，返回所有 CRS 的位置，其结果是一个**线性索引列向量**，可直接用于 K × L × P 的 3D 资源栅格
- 传 '1based' 是为了让返回的索引直接匹配 MATLAB 的 1 起始索引

## 基于训练符号的信道估计技术

在无线通信系统中，由于信道随时间和频率的变化，接收端必须准确获取信道的瞬时**状态信息**（Channel State Information, CSI）以进行均衡和解调。

基于训练符号（导频）的信道估计是最常用的方法：

- 在发送端插入已知的参考信号
- 接收端利用参考信号恢复出参考信号处的信道衰落系数，然后采用某种处理手段(**内插、滤波或变换**等)获得完整的频域和时域信道信息。

### 基本模型

在理想情况下（无子载波间干扰 ICI），系统的 𝑁 个子载波的训练符号可以表示为：

$$
\boldsymbol{X}=\left[\begin{array}{cccc}
X[0] & 0 & \cdots & 0 \\
0 & X[1] & & \vdots \\
\vdots & & \ddots & 0 \\
0 & \cdots & 0 & X[N-1]
\end{array}\right]
$$

其中：

- $$X[k]$$为第 k 个子载波上的导频符号，其满足：
  
$$
\begin{aligned}
E\left[X_k\right] & =0 \\
\operatorname{Var}\left(X_k\right) & =\sigma^2
\end{aligned}
$$

上式说明了**导频信号的统计特性**，即均值为0，方差固定，满足**平均幅度**为0且**平均功率**一致。

- 假设所有子载波正交，矩阵 𝑋 为对角矩阵。

不妨设：

- $$\mathbf{H}=[H[0], H[1], \ldots, H[N-1]]^T$$ 为信道的频域增益向量；
- $$\mathbf{Z}=[Z[0], Z[1], \cdots, Z[N-1]]^{\mathrm{T}}$$ 为加性噪声向量，满足：

$$
E\{Z[k]\}=0, \operatorname{Var}\{Z[k]\}=\sigma_Z^2
$$

- Y 为接收到的导频信号向量。

那么接收信号模型为：

$$
\begin{aligned}
\mathbf{Y} & \triangleq\left[\begin{array}{c}
Y[0] \\
Y[1] \\
\vdots \\
Y[N-1]
\end{array}\right]=\left[\begin{array}{cccc}
X[0] & 0 & \cdots & 0 \\
0 & X[1] & & \vdots \\
\vdots & & \ddots & 0 \\
0 & \cdots & 0 & X[N-1]
\end{array}\right]\left[\begin{array}{c}
H[0] \\
H[1] \\
\vdots \\
H[N-1]
\end{array}\right]+\left[\begin{array}{c}
Z[0] \\
Z[1] \\
\vdots \\
Z[N-1]
\end{array}\right] \\
& =\mathbf{X H}+\mathbf{Z}
\end{aligned}
$$

### 最小二乘(LS)估计算法

由前文的推导，接收端导频观测模型：

$$
\mathbf{Y}=\mathbf{X} \mathbf{H}+\mathbf{Z}
$$

其中

- $$\mathbf{Y} \in \mathbb{C}^{N \times 1}$$ 为接收导频；
- $$\mathbf{X} \in \mathbb{C}^{N \times N}$$ 为已知导频矩阵（无 ICI 时为对角矩阵）
- $$\mathbf{H} \in \mathbb{C}^{N \times 1}$$ 为待估计的频域信道；
-  $$\mathbf{Z} \sim \mathcal{C} \mathcal{N}\left(\mathbf{0}, \sigma_Z^2 \mathbf{I}\right)$$ 为加性噪声。
-  

为了估计 𝐻，需要使得实际接收信号和估计信号的均方误差最小，因此考虑最小化以下代价函数：

$$
J(\hat{\mathbf{H}})=\|\mathbf{Y}-\mathbf{X} \hat{\mathbf{H}}\|^2 
$$

将上述代价函数展开：

$$
\begin{aligned}
J(\hat{\mathbf{H}}) & =(\mathbf{Y}-\mathbf{X} \hat{\mathbf{H}})^H(\mathbf{Y}-\mathbf{X} \hat{\mathbf{H}}) \\
& =\mathbf{Y}^H \mathbf{Y}-\mathbf{Y}^H \mathbf{X} \hat{\mathbf{H}}-\hat{\mathbf{H}}^H \mathbf{X}^H \mathbf{Y}+\hat{\mathbf{H}}^H \mathbf{X}^H \mathbf{X} \hat{\mathbf{H}}
\end{aligned}
$$

对代价函数$$J(\hat{\mathbf{H}})$$做$$\hat{\mathbf{H}}^H$$偏导，并令其为零：

$$
\frac{\partial J}{\partial \hat{\mathbf{H}}^H}=-\mathbf{X}^H \mathbf{Y}+\mathbf{X}^H \mathbf{X} \hat{\mathbf{H}}=\mathbf{0}
$$

于是得到：

$$
\mathbf{X}^H \mathbf{X} \hat{\mathbf{H}}=\mathbf{X}^H \mathbf{Y}
$$

从而求得：

$$
\hat{\mathbf{H}}_{\mathrm{LS}}=\left(\mathbf{X}^H \mathbf{X}\right)^{-1} \mathbf{X}^H \mathbf{Y}
$$

由于导频矩阵为对角阵，可以进一步化简：

$$
\hat{\mathbf{H}}_{\mathrm{LS}}= \mathbf{X}^{-1} \mathbf{Y}
$$

即：

$$
\hat{H}_{\mathrm{LS}}[k]=\frac{Y[k]}{X[k]}, \quad k=0, \ldots, N-1
$$

这就是工程中常见的“直接相除”LS 估计。

可以看出， LS 估计算法非常简单，要获得当前点的 LS 估计，仅需**一次除法**即可，所以 LS 估计涉及的除法在硬件实现时还可以进一步等效为**一次乘法**。

从一个角度，对 LS 估计的公式进行重写，可以得到：

$$
\hat{H}_{\mathrm{LS}}[k]=\frac{Y[k]}{X[k]}, \quad k=0, \ldots, N-1
$$

从一个角度，对 LS 估计的公式进行重写，可以得到：

$$
\hat{\mathbf{h}}=\mathbf{X}^{-1} \mathbf{y}=\mathbf{X}^{-1}(\mathbf{X} \mathbf{h}+\mathbf{z})=\mathbf{h}+\mathbf{X}^{-1} \mathbf{z}
$$

计算误差：

$$
\mathbf{e}=\mathbf{h}-\hat{\mathbf{h}}=-\mathbf{X}^{-1} \mathbf{z}
$$

计算MSE：

$$
\begin{aligned}
\mathrm{MSE}_{\mathrm{LS}} &=\mathbb{E}\left\{\mathbf{e} \mathbf{e}^{\mathrm{H}}\right\}\\ & =\mathbb{E}\left\{(\mathbf{h}-\hat{\mathbf{h}})^H(\mathbf{h}-\hat{\mathbf{h}})\right\} \\
& =\mathbb{E}\left\{\left(\mathbf{X}^{-1} \mathbf{z}\right)^H\left(\mathbf{X}^{-1} \mathbf{z}\right)\right\} \\
& =\mathbb{E}\left\{\mathbf{z}^H \mathbf{X}^{-H} \mathbf{X}^{-1} \mathbf{z}\right\} \\
& =\mathbb{E}\left\{\mathbf{z}^H\left(\mathbf{X} \mathbf{X}^H\right)^{-1} \mathbf{z}\right\} .
\end{aligned}
$$

用白噪声恒等式：

$$
\mathbb{E}\left\{\mathbf{z}^H \mathbf{A} \mathbf{z}\right\}=\operatorname{tr}\left(\mathbf{A} \mathbb{E}\left[\mathbf{z} \mathbf{z}^H\right]\right)=\sigma_z^2 \operatorname{tr}(\mathbf{A})
$$

其中 A 为任意常矩阵，$$\mathbb{E}\left[\mathbf{z} \mathbf{z}^H\right]=\sigma_z^2 \mathbf{I}$$，因此：

$$
\mathrm{MSE}_{\mathrm{LS}}=\sigma_z^2 \operatorname{tr}\left(\left(\mathbf{X} \mathbf{X}^H\right)^{-1}\right)
$$

由于 $$\mathbf{X}=\operatorname{diag}\left(x_k\right)$$ 且 $$\left|x_k\right|^2=\sigma_x^2$$（每个导频同功率），因此：

$$
\mathbf{X} \mathbf{X}^H=\sigma_x^2 \mathbf{I}
$$

带入可得：

$$
\mathrm{MSE}_{\mathrm{LS}}=\sigma_z^2 \operatorname{tr}\left(\left(\sigma_x^2 \mathbf{I}\right)^{-1}\right)=\frac{N \sigma_z^2}{\sigma_x^2}
$$

其中 𝑁 是信道维度。若取每个系数的平均 MSE，则得到：

$$
\mathrm{MSE}_{\text {per tap }}=\frac{\sigma_z^2}{\sigma_x^2}
$$

可以看到，LS 信道估计方法优点就是**实现简单，复杂度比较低**，但由于 LS 估计方法没有利用其他信道信息，受噪声干扰严重，**抗噪声能力较差**。

### 线性插值算法

信道插值算法，实际上就是利用已经估计出来的参考信号处的信道估计结果来插值出所有子载
波处的信道估计。

#### 一阶线性插值

一阶线性插值方法是最简单的插值方法，利用与当前子载波最近的两个参考信号处的估计值，**等梯度**地插出当前子载波处的信道估计，对**参考信号边界外的子载波**，采用最近的梯度来进行预测。

记相邻导频区间的“斜率”（梯度）：

$$
m_k=\frac{\hat{h}_{\mathrm{LS}}\left(p_{k+1}\right)-\hat{h}_{\mathrm{LS}}\left(p_k\right)}{p_{k+1}-p_k}=\frac{\hat{h}_{\mathrm{LS}}\left(p_{k+1}\right)-\hat{h}_{\mathrm{LS}}\left(p_k\right)}{S}
$$

**一阶线性插值/外推公式：**

对任意子载波 j，其信道估计值由下式给出：

$$
\hat{h}_{\mathrm{LS}}(j)= \begin{cases}\hat{h}_{\mathrm{LS}}\left(p_0\right)+m_0\left(j-p_0\right), & j \leq p_0 \quad \text { (左侧外推, 用最近区间的梯度) }, \\ \hat{h}_{\mathrm{LS}}\left(p_k\right)+m_k\left(j-p_k\right), & p_k<j<p_{k+1}, k=0, \ldots, M-1 \quad \text { (区间内线性插值) } \\ \hat{h}_{\mathrm{LS}}\left(p_M\right)+m_{M-1}\left(j-p_M\right), & j \geq p_M \quad \text { (右侧外推, 用最近区间的梯度) } .\end{cases}
$$

其中， pk 表示第 k 个参考信号的位置， S 为频域上两个靠近的参考信号的间隔。

#### 二阶多项式插值

该插值方法使用最近的**三个参考信号点**来进行插值，对参考信号边界外的子载波由于无法使用二次多项式，故采用线性插值来预测：

$$
h(j)=c_{-1} h_{L S}\left(p_{k-1}\right)+c_0 h_{L S}\left(p_k\right)+c_1 h_{L S}\left(p_{k+1}\right), p_k<j<p_{k+1}, k=1, \cdots, M-2
$$

其中：

$$
\begin{aligned}
& c_{-1}=\alpha(\alpha-1) / 2 \\
& c_0=(1+\alpha)(1-\alpha), \quad \alpha=\frac{j-p_k}{S} \\
& c_0=\alpha(1+\alpha) / 2
\end{aligned}
$$

当 $$p_0<j<p_1$$ 时，$$h(j)=c_{-1} h_{L S}\left(p_0\right)+c_0 h_{L S}\left(p_1\right)+c_1 h_{L S}\left(p_2\right)$$；

当 $$j<p_0 \text { 或 } j>p_{M-1}$$ 时，采用线性插值来预测边界。

#### 三次样条插值

**核心思想:**

- 用一组分段三次多项式在相邻结点间插值。
- 在整个区间保持函数值、一阶导、二阶导都连续，曲线足够光滑、数值稳定。
- 允许三阶及以上导数在结点处不连续，减少区段间相互牵连，抑制全局振荡.

**边界条件处理：**

- 自然边界：两端“弯曲度”设为零，曲线更自然平滑。
- 夹持边界：给定两端斜率，适合有端点先验的场景。
- 非节点（not-a-knot）：弱化首尾两个结点的限制，MATLAB spline 默认使用。

**优缺点：**

- 优点：光滑度高（到二阶）、抑制振荡、数值稳定。
- 缺点：计算与实现比线性插值复杂；对噪声敏感；外推能力弱。

**补充说明：**

- 插值阶数越高，理论拟合更强，但在含噪导频（尤其是 LS）下，误差易被放大并传播。
- LS + 线性插值：相对高阶方法性能损失不大、性价比高。
- LMMSE估计后，高阶插值算法带来的性能增益也非常有限。

#### 线性时域插值

通过同频域插值类似地线性插值方便获得不含参考信号的 OFDM 符号上的信道估计，此处不再赘述。

### 基于 DFT 变换的估计算法

经典的 LS 方法直接在频域处理，但实际多径信道在时域呈现近似**有限脉冲响应**（Channel Impulse Response, CIR），其显著能量集中在较短的延迟支持集（通常不超过循环前缀 CP）。

**基于 DFT 的估计**正是利用这一先验：把频域初估（常为 LS）映射到时域，截断/稀疏化以抑制噪声与泄漏，再映射回频域，得到**低噪且平滑**的 CFR 估计。

**基本思想：**

将频域初估变换到时域：

$$
\widetilde{\mathbf{h}}=\mathbf{F}_N^H \widehat{\mathbf{H}}_{\mathrm{LS}} .
$$

在时域采取一定的措施来降低噪声的影响。这些措施可以归结为对 h 进行线性变换：

$$
\widetilde{\mathbf{h}}_{D F T}=Q \widetilde{\mathbf{h}}
$$

该线性变换可以看作对时域 h 进行的滤波。其设计可以是简单加窗，每条路径单独加权，利用抽样点之间相关性整体滤波等等。

由于真实 CIR 能量集中在前 𝐿ch（估计的有效信道长度），此处选择用矩形窗对超出部分直接置0，令：

$$
\widetilde{h}[\ell]=0, \quad \ell=L_{\mathrm{ch}}, \ldots, N-1,
$$

再变换回频域：

$$
\widehat{\mathbf{H}}_{\mathrm{DFT}}=\mathbf{F}_N\left[\widetilde{h}[0], \ldots, \widetilde{h}\left[L_{\mathrm{ch}}-1\right], 0, \ldots, 0\right]^T
$$

该DFT信道估计的框图如下：

![DFT估计](/images/2025-08-12-信道估计/DFT估计.png)

基于 DFT 变换的估计算法，利用了时域内信道冲激响应的能量集中特性和使用 FFT/IFFT 来实现 DFT/IDFT 的低复杂度的特性，使得其具有较低的计算复杂度和一定的估计性能改善。

需要说明的是，DFT 变换域法本质上是把频域估计先送到时域做“截断/加窗”，再变回频域。此处如果采用时域乘矩形窗，边界子载波性能会比较差。

若改用 Hann/Hamming/Kaiser 窗等，可以一定程度上抑制频域旁瓣，减轻边缘振铃。

### LMMSE 信道估计算法

最小均方误差(MMSE)估计方法是基于统计估计理论的贝叶斯估计方法。

LMMSE算法是对LS估计的最佳线性滤波，信道估计问题可以看成对LS估计结果的**线性滤波**。

$$
\hat{H}_{L M M S E}=C \hat{H}_{L S}
$$

LMMSE 估计的目标是使估计的信道系数与实际信道系数间的均方误差最小。即最小化下面的代价函数：

$$
\arg \min _C J(\hat{H})=\arg \min _C E\left[\left\|H-\hat{H}_{L M M S E}\right\|^2\right]
$$

将全带信道 $H\in\mathbb{C}^{N_{\mathrm{fft}}}$ 与导频处粗估计 $\hat{H}_{L S}\in\mathbb{C}^{N_p}$ 视为联合高斯，此处直接给出 LMMSE 估计结果为

$$
 \hat{H}_{L M M S E} = R_{H H_p}\, \big(R_{H_p H_p} + \tfrac{1}{\gamma}I\big)^{-1} \, \hat{H}_{L S}
$$

LMMSE 信道估计方法具有优秀的性能，因为它充分利用了信道统计信息，**有效地抑制了噪声影响**。

但是，LMMSE 估计的高性能伴随着**高计算复杂度**，特别是计算相关矩阵和矩阵求逆过程。

相关代码如下：

- 用 PDP 构造“频域相关函数”rDelta[Δk]

$$
r(\Delta k)=\sum_{\ell} P_{\ell} e^{-j 2 \pi \Delta k \tau_{\ell} / N_{\mathrm{fft}}}
$$

这里 𝑃ℓ 是功率-时延分布(PDP)的路径功率，𝜏ℓ 是按采样归一化的对应时延。

```matlab
rDelta = zeros(1, Nfft);
for dk = 0:Nfft-1
    rDelta(dk+1) = sum(Power .* exp(-1j*2*pi*dk*Delay/Nfft));
end
```

这一段就是把上式离散化，计算所有可能的“子载波索引差”的相关值

- 由 rDelta 生成协方差块

$$
\left[R_{H H_p}\right]_{k, i}=r\left(\left(k-k_{p, i}\right) \bmod N_{\mathrm{fft}}\right), \quad\left[R_{H_p H_p}\right]_{i, j}=r\left(\left(k_{p, i}-k_{p, j}\right) \bmod N_{\mathrm{fft}}\right)
$$

𝑘 为全带第 𝑘 个子载波索引，𝑘𝑝,𝑖 为第 𝑖 个导频的子波索引。

对应代码：

```matlab
% R_{H H_p}  (Nfft x Np)
idx_all = 1:Nfft;
R_full_p = zeros(Nfft, Np);
for i = 1:Np
    dk = mod(idx_all - pilot_idx(i), Nfft);
    R_full_p(:, i) = rDelta(dk+1).';
end

% R_{H_p H_p}  (Np x Np)
R_pp = zeros(Np, Np);
for i = 1:Np
    for j = 1:Np
        dk = mod(pilot_idx(i) - pilot_idx(j), Nfft);
        R_pp(i, j) = rDelta(dk+1);
    end
end
```

可以看到，整块协方差矩阵只依赖索引差；用 mod 做“环形差”来匹配 DFT 的周期性。

- LMMSE 的核心矩阵式


$$
\hat{H}_{\text {LMMSE }}=R_{H H_p}\left(R_{H_p H_p}+\frac{1}{\gamma} I\right)^{-1} \hat{H}_{\text {LS }}
$$

其中：

$$\hat{H}_{\text {LS }}$$是导频处的 LS 粗估计（逐导频相除得到）

𝛾 是导频处线性值 SNR

```matlab
H_LS_p = Yp ./ Xp;     
A = R_pp + (1/gamma) * eye(Np);
% 3) LMMSE 外插到全带
H_LMMSE = R_full_p * (A \ H_LS_p); 
```
